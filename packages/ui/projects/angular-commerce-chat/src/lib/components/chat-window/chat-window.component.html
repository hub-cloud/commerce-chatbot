<div class="scc-chat-container" [class.scc-chat-open]="isOpen" [attr.data-position]="config.position">

  <!-- Chat Button -->
  <button
    class="scc-chat-button"
    (click)="toggleChat()"
    [class.scc-button-hidden]="isOpen"
    aria-label="Open chat"
  >
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
      <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
    </svg>
  </button>

  <!-- Chat Window -->
  <div class="scc-chat-window" *ngIf="isOpen">
    <!-- Header -->
    <div class="scc-chat-header">
      <h3>{{ config.title }}</h3>
      <div class="scc-header-actions">
        <button
          class="scc-icon-button"
          (click)="clearChat()"
          title="Clear conversation"
          aria-label="Clear conversation"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
          </svg>
        </button>
        <button
          class="scc-icon-button"
          (click)="toggleChat()"
          aria-label="Close chat"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Messages -->
    <div class="scc-messages-container" #messageContainer>
      <div *ngFor="let message of messages"
           class="scc-message"
           [class.scc-message-user]="message.role === 'user'"
           [class.scc-message-assistant]="message.role === 'assistant'">

        <div class="scc-message-bubble">
          <div class="scc-message-content">{{ message.content }}</div>

          <!-- Product Cards -->
          <div *ngIf="hasProducts(message)"
               class="scc-products">
            <div *ngFor="let product of getProducts(message)" class="scc-product-card">
              <div class="scc-product-info">
                <div class="scc-product-name">{{ product.name }}</div>
                <div class="scc-product-price">{{ product.price }}</div>
                <div class="scc-product-stock" *ngIf="product.stock">{{ product.stock }}</div>
              </div>
              <button class="scc-product-button">View</button>
            </div>
          </div>

          <div class="scc-message-time">
            {{ message.timestamp | date:'short' }}
          </div>
        </div>
      </div>

      <!-- Typing Indicator -->
      <div *ngIf="isTyping" class="scc-message scc-message-assistant">
        <div class="scc-message-bubble">
          <div class="scc-typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Input -->
    <div class="scc-input-container">
      <textarea
        [(ngModel)]="userInput"
        [placeholder]="config.placeholderText || 'Type your message...'"
        (keypress)="handleKeyPress($event)"
        rows="1"
        class="scc-input"
      ></textarea>
      <button
        class="scc-send-button"
        (click)="sendMessage()"
        [disabled]="!userInput.trim()"
        aria-label="Send message"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
          <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
        </svg>
      </button>
    </div>
  </div>
</div>
